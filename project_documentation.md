# Master Dashboard - توثيق المشروع

## آخر تحديث: 2025-01-14

## نظرة عامة
نظام مراقبة ذكي لتطبيق Front Line مكتوب بـ AutoHotkey v2

## الهدف الأساسي
- مراقبة حالة الاتصال في تطبيق Front Line
- التدخل التلقائي لإصلاح المشاكل
- إرسال تنبيهات عبر Telegram
- مراقبة كلمة مستهدفة في الواجهة

## هيكل المشروع

### الملفات الرئيسية
- `master.ahk` - نقطة البداية والتحكم الرئيسي
- `Watcher.ahk` - مراقب خارجي لإعادة التشغيل التلقائي
- `settings.ini` - ملف الإعدادات القابلة للتخصيص

### مجلد المكتبات (lib/)
1. `01_CoreSettings.ahk` - الإعدادات الأساسية والمتغيرات العامة
2. `02_Logging.ahk` - نظام التسجيل المتقدم
3. `03_InitAndSettings.ahk` - تهيئة النظام وتحميل الإعدادات
4. `04_Helpers.ahk` - الوظائف المساعدة (Telegram، الصور، البحث)
5. `05_TimersLogic.ahk` - منطق المؤقتات والعمليات الأساسية
6. `06_DashboardHotkeys.ahk` - واجهة المستخدم والاختصارات
7. `07_GDIPlus.ahk` - مكتبة الرسوميات المتقدمة

### مجلدات أخرى
- `images/` - صور المرجع للبحث البصري
- `screenshots/` - لقطات الشاشة للحالات المجهولة

## آلية العمل

### المؤقتات الرئيسية
- **StatusCheckTimer (90s):** فحص حالة الاتصال
- **StayOnlineTimer (180s):** النقر على Stay Online
- **RefreshTimer (420s):** تحديث الصفحة
- **MonitorTargetTimer (5s):** مراقبة الكلمة المستهدفة
- **UpdateDashboardTimer (1s):** تحديث واجهة المعلومات

### الحالات المراقبة
- **Online:** حالة طبيعية
- **Offline:** يتطلب إصلاح تلقائي
- **WorkOnMyTicket:** حالة عمل طبيعية
- **Break:** حالة استراحة
- **Launch:** حالة تشغيل
- **Unknown:** حالة غير معروفة (يتم التقاط لقطة شاشة)

### نظام الإنذار
- تشغيل صوت إنذار عند المشاكل
- إيقاف الإنذار بالضغط على CapsLock
- إيقاف مؤقت للمراقبة (3 دقائق) بعد إيقاف الإنذار

## إعدادات Telegram
- BOT_TOKEN: للتواصل مع بوت Telegram
- CHAT_ID: معرف المحادثة لاستقبال التنبيهات

## الاختصارات
- **CapsLock:** إيقاف الإنذار وإيقاف المراقبة مؤقتاً
- **Ctrl+F5:** إعادة تحميل السكريبت
- **F12:** خروج آمن من البرنامج

## ملفات السجلات
- `master_log.txt` - سجل العمليات الرئيسي
- `last_error.log` - آخر خطأ حدث
- `last_error_archive.log` - أرشيف الأخطاء
- `watcher_send_error.log` - أخطاء إرسال Telegram

---

## سجل التحديثات

### 2025-01-14 - التحليل الأولي
- تم تحليل جميع ملفات المشروع
- توثيق الهيكل العام والوظائف
- فهم آلية العمل الكاملة
- إنشاء هذا الملف للتوثيق المستمر

### 2025-01-14 - إصلاح خطأ علامات الاقتباس
- **المشكلة:** خطأ "Illegal character in expression" في السطر 336 من 04_Helpers.ahk
- **السبب:** استخدام علامات اقتباس مختلطة في دالة SendTelegramPhoto
- **الحل:** توحيد علامات الاقتباس المزدوجة مع escape characters صحيحة
- **الملف المعدل:** lib/04_Helpers.ahk (السطر 336)
- **التأثير:** إصلاح خطأ منع تشغيل السكريبت

### التحديثات المستقبلية
(سيتم إضافة التحديثات هنا مع كل تعديل)

---

## ملاحظات مهمة

1. **الأمان:** يحتوي المشروع على معلومات حساسة (Telegram tokens)
2. **الاعتمادية:** يعتمد على البحث البصري في الصور
3. **التخصيص:** جميع الإعدادات قابلة للتعديل في settings.ini
4. **المراقبة:** نظام مراقبة ذاتي مع إعادة تشغيل تلقائي
5. **التوافق:** مصمم للعمل مع AutoHotkey v2

## متطلبات التشغيل
- AutoHotkey v2.0+
- تطبيق Front Line (Citrix)
- اتصال إنترنت لإرسال تنبيهات Telegram
- ملفات الصور المرجعية في مجلد images/